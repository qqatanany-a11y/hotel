

































import struct 

import dns .exception 
import dns .immutable 
import dns .name 
import dns .rdata 
import dns .rdtypes .util 


@dns .immutable .immutable 
class URI (dns .rdata .Rdata ):
    """URI record"""



    __slots__ =["priority","weight","target"]

    def __init__ (self ,rdclass ,rdtype ,priority ,weight ,target ):
        super ().__init__ (rdclass ,rdtype )
        self .priority =self ._as_uint16 (priority )
        self .weight =self ._as_uint16 (weight )
        self .target =self ._as_bytes (target ,True )
        if len (self .target )==0 :
            raise dns .exception .SyntaxError ("URI target cannot be empty")

    def to_text (self ,origin =None ,relativize =True ,**kw ):
        return '%d %d "%s"'%(self .priority ,self .weight ,self .target .decode ())

    @classmethod 
    def from_text (
    cls ,rdclass ,rdtype ,tok ,origin =None ,relativize =True ,relativize_to =None 
    ):
        priority =tok .get_uint16 ()
        weight =tok .get_uint16 ()
        target =tok .get ().unescape ()
        if not (target .is_quoted_string ()or target .is_identifier ()):
            raise dns .exception .SyntaxError ("URI target must be a string")
        return cls (rdclass ,rdtype ,priority ,weight ,target .value )

    def _to_wire (self ,file ,compress =None ,origin =None ,canonicalize =False ):
        two_ints =struct .pack ("!HH",self .priority ,self .weight )
        file .write (two_ints )
        file .write (self .target )

    @classmethod 
    def from_wire_parser (cls ,rdclass ,rdtype ,parser ,origin =None ):
        (priority ,weight )=parser .get_struct ("!HH")
        target =parser .get_remaining ()
        if len (target )==0 :
            raise dns .exception .FormError ("URI target may not be empty")
        return cls (rdclass ,rdtype ,priority ,weight ,target )

    def _processing_priority (self ):
        return self .priority 

    def _processing_weight (self ):
        return self .weight 

    @classmethod 
    def _processing_order (cls ,iterable ):
        return dns .rdtypes .util .weighted_processing_order (iterable )
